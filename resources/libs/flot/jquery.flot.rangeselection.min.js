(function(e){function t(t){function o(e){var r=t.getOptions();if(!r.rangeselection.enabled){t.getPlaceholder().css("cursor","auto");return true}var i=t.getPlaceholder().offset();var o=t.getPlotOffset();var u=e.pageX-i.left-o.left;var a=e.pageY-i.top-o.top;if(u<0||a<0){t.getPlaceholder().css("cursor","auto");return false}var l=f(0,u,t.width());if(!n.active){var c=t.getAxes().xaxis;var h=c.p2c(n.start);var p=c.p2c(n.end);var d=s;if(Math.abs(h-l)<d&&h>=0){t.getPlaceholder().css("cursor","w-resize")}else if(Math.abs(p-l)<d&&p<=t.width()){t.getPlaceholder().css("cursor","e-resize")}else if(l>h&&l<p){t.getPlaceholder().css("cursor","move")}else{t.getPlaceholder().css("cursor","auto")}return false}n.movex=l;t.triggerRedrawOverlay();return false}function u(o){var u=t.getOptions();if(!u.rangeselection.enabled)return;if(o.which!=1)return;document.body.focus();if(document.onselectstart!==undefined&&r.onselectstart==null){r.onselectstart=document.onselectstart;document.onselectstart=function(){return false}}if(document.ondrag!==undefined&&r.ondrag==null){r.ondrag=document.ondrag;document.ondrag=function(){return false}}i=function(e){a(e)};var l=t.getPlaceholder().offset();var c=t.getPlotOffset();var h=f(0,o.pageX-l.left-c.left,t.width());var p=t.getAxes().xaxis;var d=p.p2c(n.start);var v=p.p2c(n.end);var m=s;if(Math.abs(d-h)<=m){t.getPlaceholder().css("cursor","w-resize");n.handle="start";n.active=true}else if(Math.abs(v-h)<=m){t.getPlaceholder().css("cursor","e-resize");n.handle="end";n.active=true}else{t.getPlaceholder().css("cursor","move");n.handle="move";n.moveStart=v-(v-d)/2;n.active=true}i=function(e){a(e)};e(document).one("mouseup",i)}function a(e){var r=t.getOptions();if(!r.rangeselection.enabled)return true;i=null;t.getPlaceholder().css("cursor","auto");n.active=false;var s=t.getPlaceholder().offset();var o=t.getPlotOffset();var u=f(0,e.pageX-s.left-o.left,t.width());var a=t.getAxes().xaxis;var l=a.p2c(n.start);var c=a.p2c(n.end);switch(n.handle){case"start":l=u;if(u<0)l=0;if(u>c-10)l=c-10;break;case"end":c=u;if(u>t.width())c=t.width();if(u<l+10)c=l+10;break;case"move":var h=u-n.moveStart;if(l+h<0){c-=l;l=0}else if(c+h>t.width()){l=t.width()-(c-l);c=t.width()}else{c+=h;l+=h}break}n.start=a.c2p(l);n.end=a.c2p(c);var r=t.getOptions();t.triggerRedrawOverlay();if(r.rangeselection.callback&&typeof r.rangeselection.callback==="function"){r.rangeselection.callback({start:n.start,end:n.end})}return false}function f(e,t,n){return t<e?e:t>n?n:t}function l(e){var t=e.getAxes().xaxis;var r=n.movex;var i=t.p2c(n.start);var s=t.p2c(n.end);switch(n.handle){case"start":i=r;if(r<0)i=0;if(r>s-10)i=s-10;break;case"end":s=r;if(r>e.width())s=e.width();if(r<i+10)s=i+10;break;case"move":var o=r-n.moveStart;if(i+o<0){s-=i;i=0}else if(s+o>e.width()){i=e.width()-(s-i);s=e.width()}else{s+=o;i+=o}break}}function c(e,t,n,r,i,s,o,u){e.save();var a=t+r;var f=n+i;e.beginPath();e.lineWidth="4";e.moveTo(t+s,n);e.lineTo(a-s,n);e.quadraticCurveTo(a,n,a,n+s);e.lineTo(a,n+i-s);e.quadraticCurveTo(a,f,a-s,f);e.lineTo(t+s,f);e.quadraticCurveTo(t,f,t,f-s);e.lineTo(t,n+s);e.quadraticCurveTo(t,n,t+s,n);e.stroke();if(o){e.fill()}if(u){e.stroke()}e.restore()}function h(t,n,r,i){var s=t.getOptions();var o=t.getPlotOffset();n.save();n.translate(o.left,o.top);var u=e.color.parse(s.rangeselection.color);n.strokeStyle=u.scale("a",.9).toString();n.lineWidth=3;n.lineJoin="round";n.fillStyle=u.scale("a",.4).toString();var a=t.getAxes().xaxis;var f=a.p2c(r);var l=a.p2c(i);var h=f,p=0,d=l-f,v=t.height();c(n,h,p,d,v,3,true,true);n.restore()}var n={start:null,end:null,active:false,moveStart:0,movex:0,handle:"",color:"#fbb"};var r={};var i=null;var s=5;t.hooks.bindEvents.push(function(e,t){var n=e.getOptions();t.mousemove(o);t.mousedown(u)});t.hooks.draw.push(function(e,t){e.triggerRedrawOverlay()});t.hooks.drawOverlay.push(function(e,t){var r=e.getOptions();if(!r.rangeselection.enabled)return;if(n.active){var i=e.getAxes().xaxis;var s=n.movex;var o=i.p2c(n.start);var u=i.p2c(n.end);switch(n.handle){case"start":o=s;if(s<0)o=0;if(s>u-10)o=u-10;break;case"end":u=s;if(s>e.width())u=e.width();if(s<o+10)u=o+10;break;case"move":var a=s-n.moveStart;if(o+a<0){u-=o;o=0}else if(u+a>e.width()){o=e.width()-(u-o);u=e.width()}else{u+=a;o+=a}break}t.clearRect(0,0,e.width(),e.height());h(e,t,i.c2p(o),i.c2p(u));return}var f,l;if(n.end===null){if(r.rangeselection.end===null){f=e.getData();l=f[0].data;n.end=l[l.length-1][0]}else{n.end=r.rangeselection.end}}if(n.start===null){if(r.rangeselection.start===null){f=e.getData();l=f[0].data;var c=new Date(n.end);if(c.getMonth()>0){c.setMonth(c.getMonth()-1)}else{c.setYear(c.getYear()-1);c.setMonth(11)}if(l[0][0]>c.valueOf()){n.start=l[0][0]}else{n.start=c.valueOf()}}else{n.start=r.rangeselection.start}}h(e,t,n.start,n.end)});t.hooks.shutdown.push(function(t,n){n.unbind("mousemove",o);n.unbind("mousedown",u);if(i)e(document).unbind("mouseup",i)})}e.plot.plugins.push({init:t,options:{rangeselection:{color:"#f88",start:null,enabled:false,end:null,callback:null}},name:"rangeselector",version:"1.1"})})(jQuery)